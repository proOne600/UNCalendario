var fs=require("fs"),join=require("path").join,file=join(__dirname,"fixtures","error.json"),JSONStream=require("../"),it=require("it-is"),expected=JSON.parse(fs.readFileSync(file)),parser=JSONStream.parse(["rows"]),called=0,headerCalled=0,footerCalled=0,ended=!1,parsed=[];fs.createReadStream(file).pipe(parser),parser.on("header",function(e){headerCalled++,it(e).deepEqual({error:"error_code",message:"this is an error message"})}),parser.on("footer",function(){footerCalled++}),parser.on("data",function(e){called++,parsed.push(e)}),parser.on("end",function(){ended=!0}),process.on("exit",function(){it(called).equal(0),it(headerCalled).equal(1),it(footerCalled).equal(0),console.error("PASSED")});